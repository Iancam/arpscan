#!/usr/bin/env node

'use strict';

const scanner = require('../lib/arpscanner').promisify();
const isMac = require('../lib/arpscanner').isMac;
const program = require('commander');

const pck = require('../package.json');

let command = 'arp-scan';
let args = ['-v'];
let netInterface = isMac() ? 'en0' : 'wlan0';

if (isMac()) {
    command = 'arp';
    args = ['-a', '-l'];
}

function checkArpScan() {
    const spawn = require('child_process').spawn;
    const test = spawn(command, args);

    test.on('error', function(err) {
        console.log(err);
    });
    test.on('data', function(data) {
        console.log(data);
    });
}

program
    .version(pck.version)
    .option('-C, --check-arpscan', 'Test to see if arp-scan is installed', checkArpScan)
    .option('-i, --interface [interface]', 'Interface to scan linux wlan0 macos en0', netInterface)
    .option('-v, --verbose', 'Verbose mode', false)
    .parse(process.argv);

scanner({
    command,
    args,
    verbose: !!program.verbose,
    interface: program.interface
}).then(data => {
    process.stdout.write(JSON.stringify(data) + '\n');
}).catch(err => {
    process.stderr.write(err + '\n');
    process.exit(1);
});